<!DOCTYPE html>
<html lang="en">
    <head>
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta http-equiv="content-type" content="text/html; charset=utf-8">

      <!-- Enable responsiveness on mobile devices-->
      <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

      <title></title>

      
        <link rel="alternate" type="application/rss+xml" title="RSS" href="https://wonkwh.github.io/rss.xml">
      

      
          <link rel="stylesheet" href="https://wonkwh.github.io/site.css">
      

      
      
    </head>

    <body class="hack dark main container">
        

<article itemscope itemtype="http://schema.org/BlogPosting">
    <header>
        <h1 itemprop="headline">fluid interface effect</h1>
        <span class="muted">
    <svg style="margin-bottom:-3px" class="i-clock" viewBox="0 0 32 32"
         width="16" height="16" fill="none" stroke="currentcolor"
         stroke-linecap="round" stroke-linejoin="round" stroke-width="6.25%">
        <circle cx="16" cy="16" r="14"/>
        <path d="M16 8 L16 16 20 20"/>
    </svg>
    <span>3 minute read</span>
    <svg style="margin-bottom: -3px" class="i-edit" viewBox="0 0 32 32"
         width="16" height="16" fill="none" stroke="currentcolor"
         stroke-linecap="round" stroke-linejoin="round" stroke-width="6.25%">
        <path d="M30 7 L25 2 5 22 3 29 10 27 Z M21 6 L26 11 Z M5 22 L10 27 Z"/>
    </svg>

    Published: 2019-11-27
</span>
    </header>
    <div itemprop="articleBody">
      <p>wwdc2018 세션중 하나인 <a href="https://developer.apple.com/videos/play/wwdc2018/803/">Designing Fluid Interfaces</a> 를 직접 구현한 opensource중 button 구현에 대해 정리</p>
<ul>
<li><a href="https://github.com/nathangitter/fluid-interfaces">fluid-interfaces</a></li>
</ul>
<p id="zola-continue-reading"><a name="continue-reading"></a></p>
<h3 id="ios-appjjun-ggyssagihaeyi-bbeteungwa-ngaheu-hyogwa">ios app중 계산기앱의 버튼과 같은 효과</h3>
<ul>
<li>Button구현의 풀소스는 다음과 같다 </li>
</ul>
<pre style="background-color:#2b303b;">
<span style="color:#65737e;">//
//  Button.swift
//  Example
//
//  Created by kwanghyun.won on 2019/11/07.
//  Copyright © 2019 vingle. All rights reserved.
//

</span><span style="color:#b48ead;">import </span><span style="color:#ebcb8b;">UIKit</span><span style="color:#c0c5ce;">

open </span><span style="color:#b48ead;">class </span><span style="color:#ebcb8b;">Button</span><span style="color:#c0c5ce;">: </span><span style="color:#ebcb8b;">UIButton</span><span style="color:#c0c5ce;"> {
    </span><span style="color:#b48ead;">private struct </span><span style="color:#ebcb8b;">Const</span><span style="color:#c0c5ce;"> {
        </span><span style="color:#b48ead;">static let </span><span style="color:#bf616a;">borderWidth</span><span style="color:#c0c5ce;">: </span><span style="color:#ebcb8b;">CGFloat</span><span style="color:#c0c5ce;"> = </span><span style="color:#d08770;">1
        </span><span style="color:#b48ead;">static let </span><span style="color:#bf616a;">cornerRadius</span><span style="color:#c0c5ce;">: </span><span style="color:#ebcb8b;">CGFloat</span><span style="color:#c0c5ce;"> = </span><span style="color:#d08770;">2</span><span style="color:#c0c5ce;">
    }

    open </span><span style="color:#b48ead;">override var </span><span style="color:#bf616a;">intrinsicContentSize</span><span style="color:#c0c5ce;">: </span><span style="color:#ebcb8b;">CGSize</span><span style="color:#c0c5ce;"> {
        </span><span style="color:#b48ead;">var</span><span style="color:#c0c5ce;"> origSize = </span><span style="color:#b48ead;">super</span><span style="color:#c0c5ce;">.intrinsicContentSize
        origSize.height = </span><span style="color:#b48ead;">self</span><span style="color:#c0c5ce;">.size == .</span><span style="color:#d08770;">large</span><span style="color:#c0c5ce;"> ? origSize.height + </span><span style="color:#d08770;">4.0</span><span style="color:#c0c5ce;"> : origSize.height + </span><span style="color:#d08770;">2.0
        </span><span style="color:#65737e;">//dump(origSize)
        </span><span style="color:#b48ead;">return</span><span style="color:#c0c5ce;"> origSize
    }

    open </span><span style="color:#b48ead;">override func </span><span style="color:#bf616a;">tintColorDidChange</span><span style="color:#c0c5ce;">() {
        </span><span style="color:#b48ead;">super</span><span style="color:#c0c5ce;">.tintColorDidChange()
        update()
    }

    open </span><span style="color:#b48ead;">var </span><span style="color:#bf616a;">style</span><span style="color:#c0c5ce;">: </span><span style="color:#ebcb8b;">ButtonStyle</span><span style="color:#c0c5ce;"> = .</span><span style="color:#d08770;">flat</span><span style="color:#c0c5ce;"> {
        </span><span style="color:#b48ead;">didSet</span><span style="color:#c0c5ce;"> {
            </span><span style="color:#b48ead;">if</span><span style="color:#c0c5ce;"> style != oldValue {
                update()
            }
        }
    }

    open </span><span style="color:#b48ead;">var </span><span style="color:#bf616a;">size</span><span style="color:#c0c5ce;">: </span><span style="color:#ebcb8b;">ButtonSize</span><span style="color:#c0c5ce;"> = .</span><span style="color:#d08770;">large</span><span style="color:#c0c5ce;"> {
        </span><span style="color:#b48ead;">didSet</span><span style="color:#c0c5ce;"> {
            </span><span style="color:#b48ead;">if</span><span style="color:#c0c5ce;"> size != oldValue {
                update()
            }
        }
    }

    open </span><span style="color:#b48ead;">override var </span><span style="color:#bf616a;">isHighlighted</span><span style="color:#c0c5ce;">: </span><span style="color:#ebcb8b;">Bool</span><span style="color:#c0c5ce;"> {
        </span><span style="color:#b48ead;">didSet</span><span style="color:#c0c5ce;"> {
            </span><span style="color:#b48ead;">if</span><span style="color:#c0c5ce;"> isHighlighted != oldValue {
                update()
            }
        }
    }

    open </span><span style="color:#b48ead;">override var </span><span style="color:#bf616a;">isEnabled</span><span style="color:#c0c5ce;">: </span><span style="color:#ebcb8b;">Bool</span><span style="color:#c0c5ce;"> {
        </span><span style="color:#b48ead;">didSet</span><span style="color:#c0c5ce;"> {
            </span><span style="color:#b48ead;">if</span><span style="color:#c0c5ce;"> isEnabled != oldValue {
                update()
            }
        }
    }

    </span><span style="color:#b48ead;">private var</span><span style="color:#c0c5ce;"> animator = </span><span style="color:#ebcb8b;">UIViewPropertyAnimator</span><span style="color:#c0c5ce;">()
    </span><span style="color:#b48ead;">private let</span><span style="color:#c0c5ce;"> activationFeedBackGenerator = </span><span style="color:#ebcb8b;">UIImpactFeedbackGenerator</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">style</span><span style="color:#c0c5ce;">: .</span><span style="color:#d08770;">light</span><span style="color:#c0c5ce;">)

    </span><span style="color:#b48ead;">public init</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">style</span><span style="color:#c0c5ce;">: </span><span style="color:#ebcb8b;">ButtonStyle</span><span style="color:#c0c5ce;"> = .</span><span style="color:#d08770;">flat</span><span style="color:#c0c5ce;">, </span><span style="color:#bf616a;">size</span><span style="color:#c0c5ce;">: </span><span style="color:#ebcb8b;">ButtonSize</span><span style="color:#c0c5ce;"> = .</span><span style="color:#d08770;">large</span><span style="color:#c0c5ce;">) {
        </span><span style="color:#b48ead;">self</span><span style="color:#c0c5ce;">.style = style
        </span><span style="color:#b48ead;">self</span><span style="color:#c0c5ce;">.size = size
        </span><span style="color:#b48ead;">super</span><span style="color:#c0c5ce;">.</span><span style="color:#b48ead;">init</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">frame</span><span style="color:#c0c5ce;">: .</span><span style="color:#d08770;">zero</span><span style="color:#c0c5ce;">)
        initialize()
    }
    
    </span><span style="color:#b48ead;">public override init</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">frame</span><span style="color:#c0c5ce;">: </span><span style="color:#ebcb8b;">CGRect</span><span style="color:#c0c5ce;">) {
        </span><span style="color:#b48ead;">super</span><span style="color:#c0c5ce;">.</span><span style="color:#b48ead;">init</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">frame</span><span style="color:#c0c5ce;">: frame)
        initialize()
    }

    </span><span style="color:#b48ead;">public required init</span><span style="color:#c0c5ce;">?(coder </span><span style="color:#bf616a;">aDecoder</span><span style="color:#c0c5ce;">: </span><span style="color:#ebcb8b;">NSCoder</span><span style="color:#c0c5ce;">) {
        </span><span style="color:#b48ead;">super</span><span style="color:#c0c5ce;">.</span><span style="color:#b48ead;">init</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">coder</span><span style="color:#c0c5ce;">: aDecoder)
        initialize()
    }

    open </span><span style="color:#b48ead;">override func </span><span style="color:#bf616a;">layoutSubviews</span><span style="color:#c0c5ce;">() {
        </span><span style="color:#b48ead;">super</span><span style="color:#c0c5ce;">.layoutSubviews()
        layer.cornerRadius = </span><span style="color:#ebcb8b;">Const</span><span style="color:#c0c5ce;">.cornerRadius
        layer.borderWidth = style == .</span><span style="color:#d08770;">ghost</span><span style="color:#c0c5ce;"> ? </span><span style="color:#ebcb8b;">Const</span><span style="color:#c0c5ce;">.borderWidth : </span><span style="color:#d08770;">0.0</span><span style="color:#c0c5ce;">
    }

    </span><span style="color:#b48ead;">func </span><span style="color:#bf616a;">initialize</span><span style="color:#c0c5ce;">() {
        update()
        </span><span style="color:#ebcb8b;">NotificationCenter</span><span style="color:#c0c5ce;">.</span><span style="color:#b48ead;">default</span><span style="color:#c0c5ce;">.addObserver(</span><span style="color:#b48ead;">self</span><span style="color:#c0c5ce;">, </span><span style="color:#bf616a;">selector</span><span style="color:#c0c5ce;">: #selector(didContentSizeCategoryDidChange),
                                               </span><span style="color:#bf616a;">name</span><span style="color:#c0c5ce;">: </span><span style="color:#ebcb8b;">UIContentSizeCategory</span><span style="color:#c0c5ce;">.didChangeNotification, </span><span style="color:#bf616a;">object</span><span style="color:#c0c5ce;">: </span><span style="color:#d08770;">nil</span><span style="color:#c0c5ce;">)
        addTarget(</span><span style="color:#b48ead;">self</span><span style="color:#c0c5ce;">, </span><span style="color:#bf616a;">action</span><span style="color:#c0c5ce;">: #selector(didTouchDown), </span><span style="color:#b48ead;">for</span><span style="color:#c0c5ce;">: [.</span><span style="color:#d08770;">touchDown</span><span style="color:#c0c5ce;">, .</span><span style="color:#d08770;">touchDragEnter</span><span style="color:#c0c5ce;">])
        addTarget(</span><span style="color:#b48ead;">self</span><span style="color:#c0c5ce;">, </span><span style="color:#bf616a;">action</span><span style="color:#c0c5ce;">: #selector(didTouchUp), </span><span style="color:#b48ead;">for</span><span style="color:#c0c5ce;">: [.</span><span style="color:#d08770;">touchUpInside</span><span style="color:#c0c5ce;">, .</span><span style="color:#d08770;">touchDragExit</span><span style="color:#c0c5ce;">, .</span><span style="color:#d08770;">touchCancel</span><span style="color:#c0c5ce;">])
    }

    </span><span style="color:#b48ead;">private func </span><span style="color:#bf616a;">update</span><span style="color:#c0c5ce;">() {
        setTitleColor(style.titleColor, </span><span style="color:#b48ead;">for</span><span style="color:#c0c5ce;">: .</span><span style="color:#d08770;">normal</span><span style="color:#c0c5ce;">)
        setTitleColor(style.hightlightTitleColor, </span><span style="color:#b48ead;">for</span><span style="color:#c0c5ce;">: .</span><span style="color:#d08770;">highlighted</span><span style="color:#c0c5ce;">)
        setTitleColor(style.disableTitleColor, </span><span style="color:#b48ead;">for</span><span style="color:#c0c5ce;">: .</span><span style="color:#d08770;">disabled</span><span style="color:#c0c5ce;">)

        </span><span style="color:#b48ead;">self</span><span style="color:#c0c5ce;">.backgroundColor = isEnabled ? style.backgroundColor : style.disableBackgroundColor

        layer.borderColor = isEnabled ? style.titleColor.cgColor : style.disableTitleColor.cgColor

        titleLabel?.font = size.titleFont
        </span><span style="color:#b48ead;">let </span><span style="color:#bf616a;">lineHeight</span><span style="color:#c0c5ce;">: </span><span style="color:#ebcb8b;">CGFloat</span><span style="color:#c0c5ce;"> = (size == .</span><span style="color:#d08770;">large</span><span style="color:#c0c5ce;">) ? </span><span style="color:#d08770;">22.0</span><span style="color:#c0c5ce;"> : </span><span style="color:#d08770;">19.0</span><span style="color:#c0c5ce;">
        titleLabel?.setLineHeight(</span><span style="color:#bf616a;">lineHeight</span><span style="color:#c0c5ce;">: lineHeight)

        contentEdgeInsets = size.contentEdgeInsets
    }

}

</span><span style="color:#65737e;">// MARK: - event
</span><span style="color:#b48ead;">extension </span><span style="color:#ebcb8b;">Button</span><span style="color:#c0c5ce;"> {
    </span><span style="color:#b48ead;">@objc private func </span><span style="color:#bf616a;">didContentSizeCategoryDidChange</span><span style="color:#c0c5ce;">() {
        update()
    }

    </span><span style="color:#b48ead;">@objc private func </span><span style="color:#bf616a;">didTouchDown</span><span style="color:#c0c5ce;">() {
        animator.stopAnimation(</span><span style="color:#d08770;">true</span><span style="color:#c0c5ce;">)
        backgroundColor = style.hightlightBackgroundColor
        layer.borderColor = </span><span style="color:#ebcb8b;">Colors</span><span style="color:#c0c5ce;">.</span><span style="color:#ebcb8b;">Button</span><span style="color:#c0c5ce;">.borderHighlighted.cgColor
        activationFeedBackGenerator.impactOccurred()
    }

    </span><span style="color:#b48ead;">@objc private func </span><span style="color:#bf616a;">didTouchUp</span><span style="color:#c0c5ce;">() {
        animator = </span><span style="color:#ebcb8b;">UIViewPropertyAnimator</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">duration</span><span style="color:#c0c5ce;">: </span><span style="color:#d08770;">0.5</span><span style="color:#c0c5ce;">, </span><span style="color:#bf616a;">curve</span><span style="color:#c0c5ce;">: .</span><span style="color:#d08770;">easeOut</span><span style="color:#c0c5ce;">, </span><span style="color:#bf616a;">animations</span><span style="color:#c0c5ce;">: {
            </span><span style="color:#b48ead;">self</span><span style="color:#c0c5ce;">.backgroundColor = </span><span style="color:#b48ead;">self</span><span style="color:#c0c5ce;">.style.backgroundColor
            </span><span style="color:#b48ead;">self</span><span style="color:#c0c5ce;">.layer.borderColor = </span><span style="color:#ebcb8b;">Colors</span><span style="color:#c0c5ce;">.</span><span style="color:#ebcb8b;">Button</span><span style="color:#c0c5ce;">.border.cgColor
        })
        animator.startAnimation()
    }
}

</span></pre>
<ul>
<li>위소스중 계산기 버튼과 같은 효과를 주기위한 효과는 </li>
</ul>
<pre style="background-color:#2b303b;">
<span style="color:#b48ead;">private var</span><span style="color:#c0c5ce;"> animator = </span><span style="color:#ebcb8b;">UIViewPropertyAnimator</span><span style="color:#c0c5ce;">()
</span><span style="color:#65737e;">///...

    </span><span style="color:#b48ead;">@objc private func </span><span style="color:#bf616a;">didTouchDown</span><span style="color:#c0c5ce;">() {
        animator.stopAnimation(</span><span style="color:#d08770;">true</span><span style="color:#c0c5ce;">)
        backgroundColor = style.hightlightBackgroundColor
        </span><span style="color:#65737e;">//..
</span><span style="color:#c0c5ce;">    }

    </span><span style="color:#b48ead;">@objc private func </span><span style="color:#bf616a;">didTouchUp</span><span style="color:#c0c5ce;">() {
        animator = </span><span style="color:#ebcb8b;">UIViewPropertyAnimator</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">duration</span><span style="color:#c0c5ce;">: </span><span style="color:#d08770;">0.5</span><span style="color:#c0c5ce;">, </span><span style="color:#bf616a;">curve</span><span style="color:#c0c5ce;">: .</span><span style="color:#d08770;">easeOut</span><span style="color:#c0c5ce;">, </span><span style="color:#bf616a;">animations</span><span style="color:#c0c5ce;">: {
            </span><span style="color:#b48ead;">self</span><span style="color:#c0c5ce;">.backgroundColor = </span><span style="color:#b48ead;">self</span><span style="color:#c0c5ce;">.style.backgroundColor
            </span><span style="color:#b48ead;">self</span><span style="color:#c0c5ce;">.layer.borderColor = </span><span style="color:#ebcb8b;">Colors</span><span style="color:#c0c5ce;">.</span><span style="color:#ebcb8b;">Button</span><span style="color:#c0c5ce;">.border.cgColor
        })
        animator.startAnimation()
    }

</span></pre><h2 id="flashlight-button-gwa-ngaheu-hwagdda-cugso-aenimeissyeogwa-jjiddon-feedback">flashlight button 과 같은 확대,축소 애니메이션과 진동 feedback</h2>
<pre style="background-color:#2b303b;">
<span style="color:#c0c5ce;">위 버튼 구현 소스에는 확대,축소 애니메이션은 구현되어 있지 않다 
</span></pre>
<ul>
<li>진동 피드백 효과</li>
</ul>
<pre style="background-color:#2b303b;">
<span style="color:#c0c5ce;">
    </span><span style="color:#b48ead;">private let</span><span style="color:#c0c5ce;"> activationFeedBackGenerator = </span><span style="color:#ebcb8b;">UIImpactFeedbackGenerator</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">style</span><span style="color:#c0c5ce;">: 
    .</span><span style="color:#d08770;">light</span><span style="color:#c0c5ce;">)
    </span><span style="color:#65737e;">//...
    </span><span style="color:#b48ead;">@objc private func </span><span style="color:#bf616a;">didTouchDown</span><span style="color:#c0c5ce;">() {
        activationFeedBackGenerator.impactOccurred()
    }
</span></pre>
<ul>
<li>확대,축소 효과를 주려면 아래 코드를 추가하면 된다. </li>
</ul>
<pre style="background-color:#2b303b;">
<span style="color:#c0c5ce;"> </span><span style="color:#b48ead;">private func </span><span style="color:#bf616a;">animate</span><span style="color:#c0c5ce;">() {
        </span><span style="color:#b48ead;">let</span><span style="color:#c0c5ce;"> timingParameters = </span><span style="color:#ebcb8b;">UISpringTimingParameters</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">damping</span><span style="color:#c0c5ce;">: </span><span style="color:#d08770;">0.4</span><span style="color:#c0c5ce;">, </span><span style="color:#bf616a;">response</span><span style="color:#c0c5ce;">: </span><span style="color:#d08770;">0.2</span><span style="color:#c0c5ce;">)
        </span><span style="color:#b48ead;">let</span><span style="color:#c0c5ce;"> animator = </span><span style="color:#ebcb8b;">UIViewPropertyAnimator</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">duration</span><span style="color:#c0c5ce;">: </span><span style="color:#d08770;">0</span><span style="color:#c0c5ce;">, </span><span style="color:#bf616a;">timingParameters</span><span style="color:#c0c5ce;">: timingParameters)
        animator.addAnimations {
            </span><span style="color:#b48ead;">self</span><span style="color:#c0c5ce;">.transform = </span><span style="color:#ebcb8b;">CGAffineTransform</span><span style="color:#c0c5ce;">(</span><span style="color:#bf616a;">scaleX</span><span style="color:#c0c5ce;">: </span><span style="color:#d08770;">1</span><span style="color:#c0c5ce;">, </span><span style="color:#bf616a;">y</span><span style="color:#c0c5ce;">: </span><span style="color:#d08770;">1</span><span style="color:#c0c5ce;">)
            </span><span style="color:#b48ead;">self</span><span style="color:#c0c5ce;">.backgroundColor = </span><span style="color:#b48ead;">self</span><span style="color:#c0c5ce;">.isOn ? </span><span style="color:#b48ead;">self</span><span style="color:#c0c5ce;">.onColor : </span><span style="color:#b48ead;">self</span><span style="color:#c0c5ce;">.offColor
        }
        animator.isInterruptible = </span><span style="color:#d08770;">true</span><span style="color:#c0c5ce;">
        animator.startAnimation()
    }
</span></pre>
    </div>

    
        <footer>
            <hr>
            <p>
                
                    Published by Kwanghyun Won
                
                
                
                    and tagged
                    
                        <a href="https://wonkwh.github.io/tags/swift/">swift</a>
                        
                            
                                
                                    ,
                                
                            
                        
                    
                        <a href="https://wonkwh.github.io/tags/uikit/">uikit</a>
                        
                            
                                
                                    ,
                                
                            
                        
                    
                        <a href="https://wonkwh.github.io/tags/animation/">animation</a>
                        
                            
                                
                                    and
                                
                            
                        
                    
                        <a href="https://wonkwh.github.io/tags/wwdc/">wwdc</a>
                        
                            
                        
                    
                
            </p>
        </footer>
    
</article>


    </body>

</html>
