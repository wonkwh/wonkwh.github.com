<!DOCTYPE html>
<html lang="en">
    <head>
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta http-equiv="content-type" content="text/html; charset=utf-8">

      <!-- Enable responsiveness on mobile devices-->
      <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

      <title></title>

      

      
          <link rel="stylesheet" href="https://wonkwh.github.io/site.css">
      

      
      
    </head>

    <body class="hack dark main container">
        

<article itemscope itemtype="http://schema.org/BlogPosting">
    <header>
        <h1 itemprop="headline">Building Better View</h1>
        <span class="muted">
    <svg style="margin-bottom:-3px" class="i-clock" viewBox="0 0 32 32"
         width="16" height="16" fill="none" stroke="currentcolor"
         stroke-linecap="round" stroke-linejoin="round" stroke-width="6.25%">
        <circle cx="16" cy="16" r="14"/>
        <path d="M16 8 L16 16 20 20"/>
    </svg>
    <span>4 minute read</span>
    <svg style="margin-bottom: -3px" class="i-edit" viewBox="0 0 32 32"
         width="16" height="16" fill="none" stroke="currentcolor"
         stroke-linecap="round" stroke-linejoin="round" stroke-width="6.25%">
        <path d="M30 7 L25 2 5 22 3 29 10 27 Z M21 6 L26 11 Z M5 22 L10 27 Z"/>
    </svg>

    Published: 2020-03-15
</span>
    </header>
    <div itemprop="articleBody">
      <p>Model, ViewModel 을 view로 보여주어야 할떄 <code>viewData protocol</code> 을 이용하여 일관적으로 view를 configure 하는 방법</p>
<ul>
<li>original article 
<ul>
<li><a href="https://www.fabisevi.ch/2019/12/26/building-better-views-part-i/">Building better view</a></li>
</ul>
</li>
</ul>
<span id="continue-reading"></span><h2 id="ggayo">개요</h2>
<ol>
<li>A UIView instance. This is your standard view that you’ll be displaying in an app. It can be a regular class, or a custom subclass as you need.</li>
<li>A ViewData protocol. This is what’s going to keep track of the data that needs to be displayed in your view. Most commonly this will be a slice of a model, used specifically for rendering the view.</li>
<li>A configure(viewData: ViewData) function. This is what’s going to map your View to your ViewData.</li>
</ol>
<p><img src="https://fabisevi.ch//assets/img/view_data_diagram.png" alt="Diagram" /></p>
<h2 id="ilbanjjeoin-guhyeon">일반적인 구현</h2>
<h3 id="api">API</h3>
<ul>
<li><code>itunes api</code> 를 이용하여 music track을 보여주는 예제 </li>
<li>IU의 음악을 검색하려면 다음과 같은 rest api 
<ul>
<li><code>https://itunes.apple.com/search?term=IU&amp;offset=0&amp;limit=20</code></li>
<li>깔끔히 보려면 요사이트를 이용하면 좋다 
<ul>
<li>https://jsonformatter.org/json-pretty-print</li>
</ul>
</li>
<li>결과는  아래와 같다 </li>
</ul>
</li>
</ul>
<pre style="background-color:#2b303b;">
<code class="language-json" data-lang="json"><span style="color:#c0c5ce;">{
  &quot;</span><span style="color:#a3be8c;">resultCount</span><span style="color:#c0c5ce;">&quot;: </span><span style="color:#d08770;">20</span><span style="color:#c0c5ce;">,
  &quot;</span><span style="color:#a3be8c;">results</span><span style="color:#c0c5ce;">&quot;: [
    {
      &quot;</span><span style="color:#a3be8c;">wrapperType</span><span style="color:#c0c5ce;">&quot;: &quot;</span><span style="color:#a3be8c;">track</span><span style="color:#c0c5ce;">&quot;,
      &quot;</span><span style="color:#a3be8c;">kind</span><span style="color:#c0c5ce;">&quot;: &quot;</span><span style="color:#a3be8c;">song</span><span style="color:#c0c5ce;">&quot;,
      &quot;</span><span style="color:#a3be8c;">artistId</span><span style="color:#c0c5ce;">&quot;: </span><span style="color:#d08770;">409076743</span><span style="color:#c0c5ce;">,
      &quot;</span><span style="color:#a3be8c;">collectionId</span><span style="color:#c0c5ce;">&quot;: </span><span style="color:#d08770;">1438614238</span><span style="color:#c0c5ce;">,
      &quot;</span><span style="color:#a3be8c;">trackId</span><span style="color:#c0c5ce;">&quot;: </span><span style="color:#d08770;">1438614348</span><span style="color:#c0c5ce;">,
      &quot;</span><span style="color:#a3be8c;">artistName</span><span style="color:#c0c5ce;">&quot;: &quot;</span><span style="color:#a3be8c;">IU</span><span style="color:#c0c5ce;">&quot;,
      &quot;</span><span style="color:#a3be8c;">collectionName</span><span style="color:#c0c5ce;">&quot;: &quot;</span><span style="color:#a3be8c;">Bbibbi - Single</span><span style="color:#c0c5ce;">&quot;,
      &quot;</span><span style="color:#a3be8c;">trackName</span><span style="color:#c0c5ce;">&quot;: &quot;</span><span style="color:#a3be8c;">Bbibbi</span><span style="color:#c0c5ce;">&quot;,
      &quot;</span><span style="color:#a3be8c;">collectionCensoredName</span><span style="color:#c0c5ce;">&quot;: &quot;</span><span style="color:#a3be8c;">Bbibbi - Single</span><span style="color:#c0c5ce;">&quot;,
      &quot;</span><span style="color:#a3be8c;">trackCensoredName</span><span style="color:#c0c5ce;">&quot;: &quot;</span><span style="color:#a3be8c;">Bbibbi</span><span style="color:#c0c5ce;">&quot;,
      &quot;</span><span style="color:#a3be8c;">artistViewUrl</span><span style="color:#c0c5ce;">&quot;: &quot;</span><span style="color:#a3be8c;">https://music.apple.com/us/artist/iu/409076743?uo=4</span><span style="color:#c0c5ce;">&quot;,
      &quot;</span><span style="color:#a3be8c;">collectionViewUrl</span><span style="color:#c0c5ce;">&quot;: &quot;</span><span style="color:#a3be8c;">https://music.apple.com/us/album/bbibbi/1438614238?i=1438614348&amp;uo=4</span><span style="color:#c0c5ce;">&quot;,
      &quot;</span><span style="color:#a3be8c;">trackViewUrl</span><span style="color:#c0c5ce;">&quot;: &quot;</span><span style="color:#a3be8c;">https://music.apple.com/us/album/bbibbi/1438614238?i=1438614348&amp;uo=4</span><span style="color:#c0c5ce;">&quot;,
      &quot;</span><span style="color:#a3be8c;">previewUrl</span><span style="color:#c0c5ce;">&quot;: &quot;</span><span style="color:#a3be8c;">https://audio-ssl.itunes.apple.com/itunes-assets/AudioPreview128/v4/12/d9/6b/12d96b32-66b2-359c-b4d9-9d595b585a0d/mzaf_6786449235518924873.plus.aac.p.m4a</span><span style="color:#c0c5ce;">&quot;,
      &quot;</span><span style="color:#a3be8c;">artworkUrl30</span><span style="color:#c0c5ce;">&quot;: &quot;</span><span style="color:#a3be8c;">https://is5-ssl.mzstatic.com/image/thumb/Music118/v4/43/cf/eb/43cfeb10-6da1-d6dd-1cc5-e1f461947052/source/30x30bb.jpg</span><span style="color:#c0c5ce;">&quot;,
      &quot;</span><span style="color:#a3be8c;">artworkUrl60</span><span style="color:#c0c5ce;">&quot;: &quot;</span><span style="color:#a3be8c;">https://is5-ssl.mzstatic.com/image/thumb/Music118/v4/43/cf/eb/43cfeb10-6da1-d6dd-1cc5-e1f461947052/source/60x60bb.jpg</span><span style="color:#c0c5ce;">&quot;,
      &quot;</span><span style="color:#a3be8c;">artworkUrl100</span><span style="color:#c0c5ce;">&quot;: &quot;</span><span style="color:#a3be8c;">https://is5-ssl.mzstatic.com/image/thumb/Music118/v4/43/cf/eb/43cfeb10-6da1-d6dd-1cc5-e1f461947052/source/100x100bb.jpg</span><span style="color:#c0c5ce;">&quot;,
      &quot;</span><span style="color:#a3be8c;">collectionPrice</span><span style="color:#c0c5ce;">&quot;: </span><span style="color:#d08770;">1.29</span><span style="color:#c0c5ce;">,
      &quot;</span><span style="color:#a3be8c;">trackPrice</span><span style="color:#c0c5ce;">&quot;: </span><span style="color:#d08770;">1.29</span><span style="color:#c0c5ce;">,
      &quot;</span><span style="color:#a3be8c;">releaseDate</span><span style="color:#c0c5ce;">&quot;: &quot;</span><span style="color:#a3be8c;">2018-10-10T12:00:00Z</span><span style="color:#c0c5ce;">&quot;,
      &quot;</span><span style="color:#a3be8c;">collectionExplicitness</span><span style="color:#c0c5ce;">&quot;: &quot;</span><span style="color:#a3be8c;">notExplicit</span><span style="color:#c0c5ce;">&quot;,
      &quot;</span><span style="color:#a3be8c;">trackExplicitness</span><span style="color:#c0c5ce;">&quot;: &quot;</span><span style="color:#a3be8c;">notExplicit</span><span style="color:#c0c5ce;">&quot;,
      &quot;</span><span style="color:#a3be8c;">discCount</span><span style="color:#c0c5ce;">&quot;: </span><span style="color:#d08770;">1</span><span style="color:#c0c5ce;">,
      &quot;</span><span style="color:#a3be8c;">discNumber</span><span style="color:#c0c5ce;">&quot;: </span><span style="color:#d08770;">1</span><span style="color:#c0c5ce;">,
      &quot;</span><span style="color:#a3be8c;">trackCount</span><span style="color:#c0c5ce;">&quot;: </span><span style="color:#d08770;">1</span><span style="color:#c0c5ce;">,
      &quot;</span><span style="color:#a3be8c;">trackNumber</span><span style="color:#c0c5ce;">&quot;: </span><span style="color:#d08770;">1</span><span style="color:#c0c5ce;">,
      &quot;</span><span style="color:#a3be8c;">trackTimeMillis</span><span style="color:#c0c5ce;">&quot;: </span><span style="color:#d08770;">194425</span><span style="color:#c0c5ce;">,
      &quot;</span><span style="color:#a3be8c;">country</span><span style="color:#c0c5ce;">&quot;: &quot;</span><span style="color:#a3be8c;">USA</span><span style="color:#c0c5ce;">&quot;,
      &quot;</span><span style="color:#a3be8c;">currency</span><span style="color:#c0c5ce;">&quot;: &quot;</span><span style="color:#a3be8c;">USD</span><span style="color:#c0c5ce;">&quot;,
      &quot;</span><span style="color:#a3be8c;">primaryGenreName</span><span style="color:#c0c5ce;">&quot;: &quot;</span><span style="color:#a3be8c;">K-Pop</span><span style="color:#c0c5ce;">&quot;,
      &quot;</span><span style="color:#a3be8c;">isStreamable</span><span style="color:#c0c5ce;">&quot;: </span><span style="color:#d08770;">true
    </span><span style="color:#c0c5ce;">},
    </span><span style="background-color:#bf616a;color:#2b303b;">...</span><span style="color:#c0c5ce;">
</span></code></pre><h3 id="model">Model</h3>
<ul>
<li>필요한 필드만 빼서 만든 model object</li>
</ul>
<pre style="background-color:#2b303b;">
<code class="language-swift" data-lang="swift"><span style="color:#b48ead;">struct</span><span style="color:#c0c5ce;"> SearchResult: Decodable {
    </span><span style="color:#b48ead;">let</span><span style="color:#c0c5ce;"> resultCount: Int
    </span><span style="color:#b48ead;">let</span><span style="color:#c0c5ce;"> results: [Result]
}

</span><span style="color:#b48ead;">struct</span><span style="color:#c0c5ce;"> Result: Decodable {
    </span><span style="color:#b48ead;">let</span><span style="color:#c0c5ce;"> trackId: Int
    </span><span style="color:#b48ead;">let</span><span style="color:#c0c5ce;"> trackName: String
    </span><span style="color:#b48ead;">let</span><span style="color:#c0c5ce;"> primaryGenreName: String
    </span><span style="color:#b48ead;">var</span><span style="color:#c0c5ce;"> averageUserRating: Float?
    </span><span style="color:#b48ead;">var</span><span style="color:#c0c5ce;"> screenshotUrls: [String]?
    </span><span style="color:#b48ead;">let</span><span style="color:#c0c5ce;"> artworkUrl100: String </span><span style="color:#65737e;">// app icon
    </span><span style="color:#b48ead;">var</span><span style="color:#c0c5ce;"> formattedPrice: String?
    </span><span style="color:#b48ead;">var</span><span style="color:#c0c5ce;"> description: String?
    </span><span style="color:#b48ead;">var</span><span style="color:#c0c5ce;"> releaseNotes: String?
    </span><span style="color:#b48ead;">var</span><span style="color:#c0c5ce;"> artistName: String?
    </span><span style="color:#b48ead;">var</span><span style="color:#c0c5ce;"> collectionName: String?
}

</span></code></pre><h3 id="view-guhyeon">view 구현</h3>
<ul>
<li>track list에 보여줄 cell view</li>
</ul>
<pre style="background-color:#2b303b;">
<code class="language-swift" data-lang="swift"><span style="color:#b48ead;">class</span><span style="color:#c0c5ce;"> ListCell: UICollectionViewCell {
    </span><span style="color:#b48ead;">let</span><span style="color:#c0c5ce;"> imageView = AspectFitImageView(image: </span><span style="color:#d08770;">nil</span><span style="color:#c0c5ce;">, cornerRadius: </span><span style="color:#d08770;">16</span><span style="color:#c0c5ce;">)
    </span><span style="color:#b48ead;">let</span><span style="color:#c0c5ce;"> nameLabel = UILabel(text: </span><span style="color:#a3be8c;">&quot;TrackName&quot;</span><span style="color:#c0c5ce;">, font: .boldSystemFont(ofSize: </span><span style="color:#d08770;">18</span><span style="color:#c0c5ce;">))
    </span><span style="color:#b48ead;">let</span><span style="color:#c0c5ce;"> subtitleLabel = UILabel(text: </span><span style="color:#a3be8c;">&quot;Subtitle Label&quot;</span><span style="color:#c0c5ce;">, font: .systemFont(ofSize: </span><span style="color:#d08770;">16</span><span style="color:#c0c5ce;">), numberOfLines: </span><span style="color:#d08770;">2</span><span style="color:#c0c5ce;">)

    </span><span style="color:#b48ead;">override init</span><span style="color:#c0c5ce;">(frame: CGRect) {
        </span><span style="color:#b48ead;">super</span><span style="color:#c0c5ce;">.</span><span style="color:#b48ead;">init</span><span style="color:#c0c5ce;">(frame: frame)

        hstack(
            imageView.withWidth(</span><span style="color:#d08770;">80</span><span style="color:#c0c5ce;">),
            stack(nameLabel, subtitleLabel, spacing: </span><span style="color:#d08770;">4</span><span style="color:#c0c5ce;">),
            spacing: </span><span style="color:#d08770;">16
</span><span style="color:#c0c5ce;">        ).withMargins(.allSides(</span><span style="color:#d08770;">16</span><span style="color:#c0c5ce;">))
    }

    </span><span style="color:#b48ead;">required init</span><span style="color:#c0c5ce;">?(coder aDecoder: NSCoder) {
        fatalError()
    }
}
</span></code></pre>
<ul>
<li>populate data </li>
</ul>
<pre style="background-color:#2b303b;">
<code class="language-swift" data-lang="swift"><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">override func </span><span style="color:#c0c5ce;">collectionView(_ collectionView: UICollectionView, cellForItemAt indexPath: IndexPath) -&gt; UICollectionViewCell {
        </span><span style="color:#b48ead;">let</span><span style="color:#c0c5ce;"> cell = collectionView.dequeueReusableCell(withReuseIdentifier: cellId, </span><span style="color:#b48ead;">for</span><span style="color:#c0c5ce;">: indexPath) as! ListCell

        </span><span style="color:#b48ead;">let</span><span style="color:#c0c5ce;"> track = results[indexPath.item]

        cell.nameLabel.text = track.trackName
        </span><span style="color:#b48ead;">if let</span><span style="color:#c0c5ce;"> url = URL(string: track.artworkUrl100) {
            Nuke.loadImage(with: url, into: cell.imageView)
        }

        cell.subtitleLabel.text = </span><span style="color:#a3be8c;">&quot;</span><span style="color:#c0c5ce;">\(track.artistName ?? </span><span style="color:#a3be8c;">&quot;&quot;</span><span style="color:#c0c5ce;">) </span><span style="color:#a3be8c;">• </span><span style="color:#c0c5ce;">\(track.collectionName ?? </span><span style="color:#a3be8c;">&quot;&quot;</span><span style="color:#c0c5ce;">)</span><span style="color:#a3be8c;">&quot;
</span></code></pre>
<ul>
<li>full source code는 다음 repo 를 보며 된다. 
<ul>
<li>https://github.com/wonkwh/BlogShowcase/tree/master/BlogShowcase/BlogShowcase</li>
</ul>
</li>
</ul>
<h2 id="viewdata-protocol">viewData protocol</h2>
<ul>
<li>실제 cell에 보여줄 데이터 프로토콜을 정의하고 Model object의 extension으로 구현한다.</li>
</ul>
<pre style="background-color:#2b303b;">
<code class="language-swift" data-lang="swift"><span style="color:#b48ead;">protocol</span><span style="color:#c0c5ce;"> ResultViewData {
    </span><span style="color:#b48ead;">var</span><span style="color:#c0c5ce;"> title: String { </span><span style="color:#b48ead;">get</span><span style="color:#c0c5ce;"> }
    </span><span style="color:#b48ead;">var</span><span style="color:#c0c5ce;"> subtitle: String { </span><span style="color:#b48ead;">get</span><span style="color:#c0c5ce;"> }
    </span><span style="color:#b48ead;">var</span><span style="color:#c0c5ce;"> albumCoverURL: URL? { </span><span style="color:#b48ead;">get</span><span style="color:#c0c5ce;"> }
}


</span><span style="color:#b48ead;">extension</span><span style="color:#c0c5ce;"> Result: ResultViewData {
    </span><span style="color:#b48ead;">var</span><span style="color:#c0c5ce;"> title: String {
        </span><span style="color:#b48ead;">return</span><span style="color:#c0c5ce;"> trackName
    }

    </span><span style="color:#b48ead;">var</span><span style="color:#c0c5ce;"> subtitle: String {
        </span><span style="color:#b48ead;">return </span><span style="color:#a3be8c;">&quot;</span><span style="color:#c0c5ce;">\(artistName ?? </span><span style="color:#a3be8c;">&quot;&quot;</span><span style="color:#c0c5ce;">) </span><span style="color:#a3be8c;">• </span><span style="color:#c0c5ce;">\(collectionName ?? </span><span style="color:#a3be8c;">&quot;&quot;</span><span style="color:#c0c5ce;">)</span><span style="color:#a3be8c;">&quot;
</span><span style="color:#c0c5ce;">    }

    </span><span style="color:#b48ead;">var</span><span style="color:#c0c5ce;"> albumCoverURL: URL? {
        </span><span style="color:#b48ead;">return</span><span style="color:#c0c5ce;"> URL(string: artworkUrl100)
    }
}
</span></code></pre>
<ul>
<li>view cell에 extension 으로 <code>func configure(viewData: ..)</code> 를 구현</li>
</ul>
<pre style="background-color:#2b303b;">
<code class="language-swift" data-lang="swift"><span style="color:#b48ead;">extension</span><span style="color:#c0c5ce;"> ListCell {
    </span><span style="color:#b48ead;">func </span><span style="color:#c0c5ce;">configure(viewData: ResultViewData) {
        </span><span style="color:#b48ead;">self</span><span style="color:#c0c5ce;">.nameLabel.text = viewData.title
        </span><span style="color:#b48ead;">self</span><span style="color:#c0c5ce;">.subtitleLabel.text = viewData.subtitle
        </span><span style="color:#b48ead;">if let</span><span style="color:#c0c5ce;"> url = viewData.albumCoverURL {
            Nuke.loadImage(with: url, into: </span><span style="color:#b48ead;">self</span><span style="color:#c0c5ce;">.imageView)
        }
    }
}

</span></code></pre>
<ul>
<li>populate data</li>
</ul>
<pre style="background-color:#2b303b;">
<code class="language-swift" data-lang="swift"><span style="color:#c0c5ce;">    </span><span style="color:#b48ead;">override func </span><span style="color:#c0c5ce;">collectionView(_ collectionView: UICollectionView, cellForItemAt indexPath: IndexPath) -&gt; UICollectionViewCell {
        </span><span style="color:#b48ead;">let</span><span style="color:#c0c5ce;"> cell = collectionView.dequeueReusableCell(withReuseIdentifier: cellId, </span><span style="color:#b48ead;">for</span><span style="color:#c0c5ce;">: indexPath) as! ListCell

        </span><span style="color:#b48ead;">let</span><span style="color:#c0c5ce;"> track = results[indexPath.item]
        cell.configure(viewData: track)

</span></code></pre>
<p>위와 같은 형태로 일관성있게 view model -&gt; view 로 구성할수 있다. </p>
<h2 id="camjo">참조</h2>
<ul>
<li>https://www.fabisevi.ch/2019/12/26/building-better-views-part-i/</li>
<li>https://fabisevi.ch//2019/12/26/building-better-views-part-ii</li>
</ul>

    </div>

    
        <footer>
            <hr>
            <p>
                
                    Published by Kwanghyun Won
                
                
                
                    and tagged
                    
                        <a href="https://wonkwh.github.io/tags/swift/">swift</a>
                        
                            
                                
                                    ,
                                
                            
                        
                    
                        <a href="https://wonkwh.github.io/tags/uikit/">uikit</a>
                        
                            
                                
                                    and
                                
                            
                        
                    
                        <a href="https://wonkwh.github.io/tags/viewmodel/">viewModel</a>
                        
                            
                        
                    
                
            </p>
        </footer>
    
</article>


    </body>

</html>
